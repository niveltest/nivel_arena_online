# カード能力（Effect）の実装計画

カード能力が機能していない問題を解決し、公式ルールに基づいた複雑な効果処理を実装します。

## ユーザーレビューが必要な項目

- **カードテキストの解析**: `hasKeyword` ヘルパーにより、キーワード配列だけでなくテキスト内のキーワードも検知するようにしました。
- **選択インターフェース**: `requestSelection` を通じて、プレイヤーがターゲットやサーチ対象を選択できる仕組みを導入しました。

## 変更内容

### サーバーロジック (server/Game.ts)

- [x] **キーワード検知の強化**: `hasKeyword` ヘルパーの導入。
- [x] **パッシブ効果の実装**: `getUnitPower` におけるリーダー・ユニットの常時バフ。
- [x] **戦闘キーワードの実装**: 貫通(Penetration)、略奪(Loot)、道連れ(Death Touch)、無敵(Invincible)。
- [x] **トリガーエフェクトの網羅**: 攻撃時(ON_ATTACK)、破壊時(ON_DESTROY)、退去時(EXIT_EFFECT)、登場時(ON_PLAY)。
- [x] **選択UIの連携**: ユニット破壊(KILL_UNIT)、デバフ(DEBUFF_ENEMY)、デッキ・トラッシュからのサーチ。
- [x] **一時的なステータス管理**: ターン終了時の `cannotAttack` や `tempPowerDebuff` のリセット。

### UIコンポーネント

- [x] **SelectionModalの拡張**: 捨て札以外のカード選択（ユニット選択、デッキサーチ）への対応。
- [x] **ステータス表示**: `cannotAttack` などの状態が反映されるように調整。

## 検証計画

### 自動テスト（シミュレーション）

- [x] 貫通を持つカードでユニットを破壊した際、相手リーダーにダメージが入るか確認。
- [x] 略奪を持つカードでユニットを破壊した際、ドローが発生するか確認。
- [x] 選択効果（ユニットを1体選んで破壊など）が、UIを通じて正しく動作するか確認。

### 手動確認

- [x] ターン終了時に一時的なバフ/デバフが消えることを確認。
- [x] Dorothyのエフェクトで攻撃制限がかかることを確認。
