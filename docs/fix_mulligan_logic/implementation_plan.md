# マリガン処理修正の実装計画

## 目的

CPU戦においてユーザーのマリガン処理がスキップされる問題を解消する。

## 問題の分析

- `Game.start()` で全プレイヤーに対し同期的に `requestSelection` を発行している。
- `Game` クラスの `selection` プロパティは単一であり、最後のリクエスト（CPU）で上書きされる。
- これによりユーザーへのリクエストが消滅し、クライアント側でモーダルが表示されない。

## 変更内容

### Server Side (`server/Game.ts`)

#### [MODIFY] Game.ts

- `start()` メソッド内の `requestSelection` ループを廃止。
- `proceedMulligan()` ヘルパーメソッドを新設し、未完了のプレイヤーを順次処理するロジックを実装。
- `resolveSelection` (マリガン分岐) および `resolveMulligan` メソッドにおいて、処理完了後に `proceedMulligan()` を呼び出すように変更。

## 検証計画

### 手動検証

- ブラウザでゲームを開始し、「CPU対戦」を選択。
- マリガン画面（全交換かそのままか）が表示されることを確認。
- 選択後、CPUが思考し（ログが表示され）、ゲームが「レベルアップフェーズ」に移行することを確認。
