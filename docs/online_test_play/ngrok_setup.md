# ngrok を使用したオンラインテストプレイ手順

このガイドでは、ngrok を使用してローカルサーバーを一時的に外部公開し、友人とオンラインでテストプレイする方法を説明します。

## 前提条件

- Node.js と npm がインストールされていること
- ゲームが正常にローカル環境で動作すること

## 手順

### 1. ngrok のインストール

#### Windows の場合

1. [ngrok 公式サイト](https://ngrok.com/download) からダウンロード
2. ダウンロードした `ngrok.exe` を任意のフォルダに配置
3. 環境変数 PATH に追加するか、プロジェクトフォルダに配置

#### または npm でインストール

```bash
npm install -g ngrok
```

### 2. サーバーの起動

プロジェクトのルートディレクトリで以下のコマンドを実行:

```bash
npm run dev:all
```

これにより、クライアント (Next.js) とサーバー (Socket.io) の両方が起動します。

### 3. ngrok でサーバーを公開

新しいターミナルを開き、以下のコマンドを実行:

```bash
ngrok http 3001
```

ngrok が起動すると、以下のような出力が表示されます:

```
Forwarding  https://xxxx-xxxx-xxxx.ngrok.io -> http://localhost:3001
```

この `https://xxxx-xxxx-xxxx.ngrok.io` が公開 URL です。

### 4. クライアント側の環境変数を設定

プロジェクトのルートディレクトリに `.env.local` ファイルを作成し、以下を記述:

```env
NEXT_PUBLIC_SOCKET_URL=https://xxxx-xxxx-xxxx.ngrok.io
```

**注意**: `xxxx-xxxx-xxxx` の部分は、ngrok が生成した実際の URL に置き換えてください。

### 5. クライアントを再起動

環境変数を反映させるため、クライアントを再起動します:

1. `Ctrl+C` で現在のプロセスを停止
2. 再度 `npm run dev:all` を実行

### 6. 友人とテストプレイ

1. あなたのブラウザで `http://localhost:3000` にアクセス
2. ルーム ID を作成
3. 友人に以下を共有:
   - クライアント URL: `http://localhost:3000` (あなたのローカル環境の場合)
   - または、クライアントも ngrok で公開する場合は、別のターミナルで `ngrok http 3000` を実行し、その URL を共有
   - ルーム ID

### 7. クライアントも公開する場合 (推奨)

友人がアクセスしやすいように、クライアントも ngrok で公開することをお勧めします:

1. 新しいターミナルを開く
2. 以下のコマンドを実行:

```bash
ngrok http 3000
```

1. 表示された URL (例: `https://yyyy-yyyy-yyyy.ngrok.io`) を友人に共有

## トラブルシューティング

### 接続できない場合

1. **ファイアウォールの確認**: Windows Defender ファイアウォールで Node.js が許可されているか確認
2. **ngrok の URL を確認**: `.env.local` の URL が正しいか確認
3. **サーバーが起動しているか確認**: `http://localhost:3001` にアクセスして確認
4. **環境変数が反映されているか確認**: クライアントを再起動したか確認

### ngrok の無料プランの制限

- セッションは 2 時間で切れます
- URL は毎回変わります (有料プランでは固定 URL を使用可能)
- 同時接続数に制限があります

## 本番環境へのデプロイ

より安定した環境でテストプレイしたい場合は、以下のサービスを検討してください:

- **サーバー**: Render, Railway, Heroku
- **クライアント**: Vercel, Netlify

詳細は別途デプロイガイドを参照してください。
