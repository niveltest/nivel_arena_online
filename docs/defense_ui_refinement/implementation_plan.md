# 実装計画 - 防御フェイズの表示改善と不具合修正

アタック宣言後の防御側処理（ガーディアンの発動、防御の選択）が正しく表示され、進行できるように UI とロジックを改善します。

## 変更内容

### [GameBoard.tsx](file:///c:/Users/worke\Antigravity\nivel_arena_online\components\GameBoard.tsx)

#### 1. モーダル表示とフェイズ遷移の自動化 [重要]

対向（正面）にユニットがいない場合、防御側の「防御・受ける」の選択モーダルを表示せず、直接リーダーダメージ処理へ移行するようにロジックを修正します。

- サーバー側の `attack` 処理において、ターゲットが空の場合は `DEFENSE` フェイズをスキップして即座にダメージを解決します。
- クライアント側のステータスバーにも `GUARDIAN` と `DEFENSE` フェイズを追加し、進行状況を可視化します。

#### 2. リーダーへのアタック操作の有効化

相手のリーダーカードをクリックした際、正面のレーンへのアタックとして処理されるようにします。

- 相手側リーダーの `DraggableZone` に `onClick` ハンドラを追加。
- 選択中の `attackingUnitIndex` を用いてアタックを送信します。

#### 3. モーダルの堅牢性向上

データ同期のタイミングで一時的にアタッカー情報等が欠落しても、フェイズが合致していればエラー表示にならず「処理中」の状態を維持するように `renderDefenseModal` 等を修正します。

#### 4. 次フェイズボタンの制御

防御フェイズ中など、プレイヤーの操作が制限されるタイミングで「NEXT PHASE」ボタンの状態を適切に管理します。

## 検証計画

### 手動確認

- ユニットで相手のユニットを攻撃した際、フェイズトラックが「防御フェイズ」に切り替わり、防御側プレイヤーに選択モーダルが表示されるか確認。
- 相手のリーダーをクリックして、直接攻撃が発生するか確認。
- ガーディアン（防壁）を持つユニットが隣接している場合、「ガーディアンフェイズ」が表示されるか確認。
- 全てのモーダルが表示されている間、背景の操作が意図せず行われないか確認。
