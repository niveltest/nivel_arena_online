# 修正内容の確認 - 防御フェイズの表示改善

防御側の処理（ガーディアン、防御選択）が正しく表示され、進行できるように改善しました。

## 変更内容

### 1. フェイズ状態の可視化

ステータスバーのフェイズトラックに「防壁（ガーディアン）」と「防御」を追加しました。

- アタック宣言後、どのステップにいるかが一目でわかるようになりました。

### 2. リーダーへのアタック操作

相手のリーダー画像を直接クリックしてアタックできるようになりました。

- アタッカーを選択した状態で相手リーダーをクリックすると、正面のレーンへのアタックとして処理されます。
- 対向ユニットがいない場合は、そのままダイレクトダメージへと進行します。

### 3. モーダル表示の堅牢化

通信やデータ更新のわずかなラグでモーダルが消えないよう、以下の対策を行いました。

- データ（アタッカー情報など）が一時的に取得できない場合も、「読み込み中...」の表示を維持してモーダルを閉じないようにしました。
- 相手が選択中の場合も、待機中であることがわかるメッセージを表示します。

### 4. 特殊キーワードへの対応

- **突破 (BREAKTHROUGH)**: 攻撃側が「突破」を持っている場合、防御側の「防御」ボタンを無効化し、強制的にダメージを受ける状態にしました。

### 5. AI および サーバーロジックの修正

- AI がアタックする際、正しくレーンインデックスを指定するように修正しました。
- サーバー側で「リーダーへのアタック」を示すインデックス `-1` を受け取った際、適切にレーン攻撃として正規化するようにしました。

## 検証結果

- [x] フェイズトラックに「防壁」「防御」が表示されることを確認。
- [x] 相手のリーダーをクリックしてアタックを送信できることを確認。
- [x] ユニットがいないレーンへのアタックで即座にダメージ処理（ reveal ）へ移行することを確認。
- [ ] （実機確認推奨）防御側でモーダルが表示され、操作可能であることを確認。
