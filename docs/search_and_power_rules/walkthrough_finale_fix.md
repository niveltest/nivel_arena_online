# 修正内容の確認 (Walkthrough) - BT01-024「フィナーレ」の条件付きドロー実装

BT01-024「フィナーレ」の「ユニットをトラッシュしたならドローする」という条件付き効果が正しく動作するように修正しました。

## 修正内容

### 1. データ構造の拡張 (`shared/types.ts`)

- `CardEffect` インターフェースに `drawOnKill` プロパティを追加しました。これにより、ある効果（パワーマイナスなど）が原因でユニットが破壊された際に発生する追加処理を定義できるようになりました。

### 2. パースロジックの強化 (`populate_effects.ts`)

- 「〜トラッシュしたなら、1枚ドローする」というテキストパターンを検出し、直前の効果（この場合はパワー-3000）に `drawOnKill` 属性を付与するようにしました。
- 同時に、無条件のドロー効果として誤検知されないよう調整しました。

### 3. ゲームエンジンの修正 (`Game.ts`)

- `checkDrawOnKill` ヘルパーメソッドを追加しました。
- `resolveSelection`（対象選択の解決時）および `applyEffect` において、`DEBUFF_ENEMY` 効果を適用した直後にユニットのパワーを確認し、0以下であればドローを実行するロジックを組み込みました。
- これにより、**「パワーマイナスによって破壊された場合のみドローする」**という正確な挙動が実現されます。

## 検証結果

### カードデータの確認

`cards.json` において、BT01-024 が以下のようにパースされていることを確認しました：

```json
{
    "id": "BT01-024",
    "name": "フィナーレ",
    "action": "DEBUFF_ENEMY",
    "value": 3000,
    "drawOnKill": 1
}
```

### 期待される挙動

1. カードを使用し、相手ユニットを選択。
2. ユニットのパワーが3000減算される。
3. 減算後のパワーが0以下なら、使用者が1枚ドローする（ログに表示される）。
4. その後、通常のSBA（状態確認処理）によりユニットがトラッシュへ移動する。
