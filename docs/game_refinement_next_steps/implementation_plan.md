# ゲームシステムの洗練とパース精度の向上

## 概要

これまでの実装で基本的なゲームプレイは可能になりましたが、一部のキーワード能力（ディフェンダー）における実装不備や、特定のカード効果（パワーを固定値にするなど）が正しくパース・処理されていない箇所があります。テストプレイをより円滑に進めるための「システムの安定化」を次のステップとして提案します。

## ユーザーレビューが必要な項目

- **ディフェンダーの挙動修正**: 攻撃対象がユニットの場合に防御側ユニットのパワーが上がる仕組みですが、現在はコード内の参照エラーにより機能していない可能性があります。
- **特定カードの効果パース**: 「バイパー」などの「パワーを1000にする」といった効果を自動で読み取れるようにします。

## 提案される変更点

### [Component] Server (Game Logic)

#### [MODIFY] [Game.ts](file:///c:/Users/worke/Antigravity/nivel_arena_online/server/Game.ts)

- `getUnitPower` 内で `this.attackTarget` を参照している箇所を、`this.pendingAttack` に基づく正しい参照（現在防御中かどうかの判定）に修正します。
- `SET_POWER` アクションが実行された際のログ出力を分かりやすく改善します。

### [Component] Scripts (Data Parsing)

#### [MODIFY] [populate_effects.ts](file:///c:/Users/worke/Antigravity/nivel_arena_online/server/scripts/populate_effects.ts)

- 正規表現を拡張し、「パワーを〜にする」「パワーが〜になる」というテキストから `SET_POWER` アクションを抽出できるようにします。
- 「味方ユニット全てに」「相手ユニット全てに」といった範囲指定のパース精度を向上させます。

## 検証計画

### 自動テスト (スクリプト実行)

- `npm run populate:effects` (仮) を実行し、`cards.json` 内の「バイパー (BT01-017)」に `SET_POWER` 効果が正しく付与されるか確認します。

### 手動検証

- `DEFENDER` を持つユニットが攻撃された際、ログにパワー上昇が表示され、正しくダメージ計算が行われるか確認。
- バイパーがプレイされた際、対向ユニットのパワーが1000に変更されるか確認。
