# 公式ルール準拠：ゲームロジック修正計画

公式サイトの解説に基づき、現在の実装を公式ルール $(Ver. 1.3)$ に準拠するように修正しました。

## 主な修正項目

### 1. マリガン (MULLIGAN) の仕様変更

- **公式ルール**: 「5枚すべてを戻して5枚引く」の全交換1回のみ。
- **実装済**: 「全交換かそのままか」の選択制に変更しました。

### 2. サイズ(Size)計算の修正

- **公式ルール**: コスト上限(サイズ) $=$ リーダーレベル $+$ 自分が受けているダメージ。
- **実装済**: `damageZone.length` を使用して、レベルとダメージの合計値をコスト上限として正しく加算するように修正しました。

### 3. ユニットの上書き配置（アップグレード）

- **公式ルール**: 既存ユニットの上に高いコストのユニットを配置できる。その際装備品も一緒にトラッシュされるが、`エグジット` は発動しない。
- **実装済**: `playCard` でのアップグレード処理において、装備品を含めたトラッシュ送りを実装しました。

### 4. ダメージチェックとトリガーの挙動

- **公式ルール**: ダメージは1枚ずつ山札から公開し、トリガーが公開されたら即座にダメージチェックを終了（残りダメージは無効）。
- **実装済**: `dealDamage` をループ処理に変更し、トリガー公開時に `break` するロジックを実装しました。

### 5. 手札上限 (Hand Size Limit)

- **公式ルール**: エンドフェイズ時に手札が8枚以上ある場合、7枚になるように捨てる。
- **実装済**: `handleEndPhase` にて 7枚制限のチェックとディスカード要求を追加しました。

### 6. デッキ構築制限の強制

- **公式ルール**: 同名カード3枚まで、トリガーアイコン持ちカード最大8枚まで。属性の一致。
- **実装済**: `start` メソッドでのデッキ初期化時にこれらの制限を厳密にチェックするようにしました。

## 検証結果

- ダメージチェック中にトリガーが出た場合、後続のダメージがキャンセルされることを確認。
- レベルアップ前でも、ダメージを受けていればサイズ制限が緩和され、高コストカードが出せることを確認。
- マリガンが全交換ルールで動作することを確認。
