# 修正完了：オーディオ音量の不整合および調整不能問題

対戦開始時に音量設定が反映されない、および音量調整が効かなくなる問題を修正しました。

## 修正内容

### 1. AudioManager の初期化と再生の完全同期

`AudioManager.ts` を修正し、初期化（`localStorage` からの設定読み込み）が完了するまでBGMの再生を開始しないようにガードを追加しました。これにより、設定読み込み前のデフォルト音量で再生が始まってしまう問題を解消しました。

### 2. 初期化完了時の音量強制反映

システムが初期化された際、すでに再生中（または待機中）のBGMオブジェクトに対しても、即座に最新の設定音量を適用するようにしました。

### 3. 非同期処理の安全性向上

BGMのフェードイン処理において、再生開始時の非同期コールバックが「現在アクティブなBGMオブジェクト」のみを操作するように修正しました。これにより、曲を切り替えた際に古い曲のフェード処理が影響を与えたり、音が止まらなくなったりするバグを防止しました。

### 4. GameBoard での初期化待ち

`GameBoard.tsx` において、`audioManager.initialize()` の完了（Promiseの解決）を待ってからBGMを再生するように変更し、二重に初期化待機を行う構成にしました。

## 検証手順

以下の手順で修正を確認してください：

1. ロビー画面で **⚙️ 設定** を開き、BGM音量を **0%** に設定して **CLOSE** を押します。
2. 対戦（CREATE/JOINどちらでも可）を開始します。
3. **対戦画面に入った直後からBGMが無音であること**を確認してください。
4. 対戦中に設定を開き、音量スライダーを動かして**正しく即座に音量が変化すること**を確認してください。
5. 設定を再度 **0%** にし、音が完全に消えることを確認してください。

> [!NOTE]
> デプロイ後、ブラウザに古いスクリプトがキャッシュされている場合は、一度 **Ctrl + F5** などでハードリフレッシュを行ってください。
