# ウォークスルー: 欠落・不十分なカード効果のブラッシュアップ (Phase 4)

## 概要

カードゲームのルール整合性を高めるため、キーワード判定の強化とターン終了時の特殊処理（帰還）の実装を完了しました。

## 変更内容

### 1. キーワード判定の堅牢化 (`server/Game.ts`)

- **表記ゆれ対応**: `ARMED` -> `アームド`、`DEFENDER` -> `ディフェンダー` などの英語・日本語マッピングを拡張しました。
- **テキストベース判定**: JSONの `keywords` 配列だけでなく、カードの `text` 内に含まれる `[アタッカー]` や `【帰還】` といった記述からもキーワードを自動判定するように強化しました。これにより、パース漏れのある既存カードも正しく動作します。

### 2. 「帰還 (Recycle)」処理の刷新

- **End Phase への統合**: これまで特定のタイミングでしか動いていなかった「帰還」ロジックを、ターンの終了時（End Phase）に必ず実行されるように修正しました。
- **全プレイヤー対象**: 自分のターン終了時に、自分だけでなく相手のトラッシュにある帰還カードも正しく手札に戻るよう、公式ルール（「ターンの終了時」に誘発）に合わせました。

### 3. サイズ制限 (BUFF_SIZE) の検証

- リーダーの `BUFF_SIZE` パッシブが、コスト上限（LeaderLevel + DamageZone）に正しく加算されていることを再確認しました。

## 検証結果 (`unitTestPhase4.ts`)

- **キーワード判定**: `ARMED`, `DEFENDER` のマッピング成功。テキスト内の `[アタッカー]` や `突破` の検知成功。
- **帰還処理**: トラッシュにある帰還持ちカードが、ターン終了時に手札に戻り、トラッシュから消えることを確認。
- **表記ゆれ帰還**: テキスト内に `【帰還】` と書かれたカードも正常に手札に戻ることを確認。
