# CPUがカードをプレイしない不具合の修正計画

CPUが「コスト不足」と誤認してカードをプレイしなくなっている問題を修正します。

## 課題の分析

- **原因**: `AIPlayer.ts` において、カードのプレイ可否を `player.state.resources` という値で判定していた。しかし、このゲームのエンジンでは `resources` は使用されておらず、代わりに「現在のフィールドの合計コスト (`currentSize`)」と「リーダーレベル＋ダメージ数 (`sizeLimit`)」の比較によって判定が行われている。
- **結果**: `resources` が常に `0` であるため、CPUは（コスト0以外の）カードを一切プレイできない状態になっていた。

## 修正内容

### 1. CPUプレイロジックの修正 (`AIPlayer.ts`)

- [MODIFY] [AIPlayer.ts](file:///c:/Users/worke/Antigravity/nivel_arena_online/server/AIPlayer.ts)
  - **コスト計算の同期**: `Game.ts` と同じ方法で現在のフィールドサイズ (`currentSize`) と制限値 (`sizeLimit`) を計算するヘルパー関数を AI クラス内に追加します。
  - **判定の修正**: `handleMainPhase` 内のフィルタリング処理において、`resources` ではなく計算した `currentSize` と `sizeLimit` を使用するように修正します。
  - **デバッグログの強化**: CPUがカードをプレイしようとした際、コスト不足で断念したのか、スロットが空いていないのかなどをサーバーログに出力するようにし、ブラックボックス化を防ぎます。

## 検証プラン

- ビルドが通ることを確認。

- CPU戦を開始し、CPUが先行・後行に関わらずコストの範囲内でユニットをプレイすることを確認。

- ダメージを受けた際に CPU のプレイ上限（サイズ制限）が正しく増加し、より多くのカードを並べるようになることを確認。
